<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Bandeau de Confidentialit√©</title>
    <link rel="stylesheet" href="popup.css">
    <style>
        body {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .test-controls h2 {
            margin-top: 0;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
        }
        
        .test-btn.secondary {
            background: #6c757d;
        }
        
        .status-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #28a745;
        }
        
        .status-box.error {
            border-left-color: #dc3545;
        }
        
        .code-block {
            background: #2d3748;
            color: #68d391;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin-top: 10px;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-20px);
            }
        }
    </style>
</head>
<body>
    <div class="test-controls">
        <h2>üß™ Test du Bandeau de Confidentialit√©</h2>
        <p>Utilisez les boutons ci-dessous pour tester le comportement du bandeau.</p>
        
        <div class="btn-group">
            <button class="test-btn" onclick="showBanner()">üëÅÔ∏è Afficher le bandeau</button>
            <button class="test-btn secondary" onclick="checkStatus()">üîç V√©rifier le statut</button>
            <button class="test-btn secondary" onclick="resetBanner()">üîÑ R√©initialiser</button>
            <button class="test-btn secondary" onclick="simulateFirstVisit()">‚ú® Simuler premi√®re visite</button>
        </div>
        
        <div id="statusDisplay"></div>
    </div>

    <!-- Bandeau de confidentialit√© (copie depuis popup-advanced.html) -->
    <div id="privacyBanner" style="display: none; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-left: 4px solid #2196F3; padding: 15px; margin: 15px 0; border-radius: 8px; position: relative; animation: slideDown 0.3s ease-out;">
        <button id="closeBanner" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 20px; cursor: pointer; color: #1976d2; opacity: 0.7; transition: opacity 0.2s;" title="Fermer d√©finitivement">√ó</button>
        <div style="display: flex; align-items: start; gap: 12px;">
            <span style="font-size: 28px; flex-shrink: 0;">üç™</span>
            <div>
                <h3 style="margin: 0 0 8px 0; color: #1565c0; font-size: 15px; font-weight: 600;">
                    üìå Information sur le stockage de vos pr√©f√©rences
                </h3>
                <p style="margin: 0 0 10px 0; color: #0d47a1; font-size: 13px; line-height: 1.6;">
                    Cette extension utilise <strong>localStorage</strong> et <strong>chrome.storage.sync</strong> pour sauvegarder vos param√®tres <strong>localement sur votre appareil</strong>.
                </p>
                <ul style="margin: 0 0 10px 0; padding-left: 20px; color: #0d47a1; font-size: 12px; line-height: 1.8;">
                    <li>‚úÖ <strong>Aucune donn√©e envoy√©e vers un serveur</strong></li>
                    <li>‚úÖ <strong>Pas de cookies tiers</strong> (stockage natif uniquement)</li>
                    <li>‚úÖ <strong>Pas de tracking</strong> ou collecte d'usage</li>
                    <li>‚úÖ <strong>Synchronisation Google</strong> (si connect√© √† Chrome)</li>
                    <li>‚úÖ <strong>Export/Import manuel</strong> disponible ci-dessous</li>
                </ul>
                <p style="margin: 0; color: #1565c0; font-size: 12px; font-style: italic;">
                    üí° En utilisant cette extension, vous acceptez le stockage local de vos pr√©f√©rences pour am√©liorer votre exp√©rience.
                </p>
            </div>
        </div>
    </div>

    <div class="test-controls">
        <h2>üìä Informations</h2>
        <p><strong>Cl√© localStorage :</strong> <code>whisper_privacy_banner_dismissed</code></p>
        <p><strong>Comportement :</strong></p>
        <ul>
            <li>‚úÖ S'affiche uniquement √† la premi√®re visite</li>
            <li>‚úÖ Se ferme avec le bouton √ó</li>
            <li>‚úÖ Se ferme automatiquement apr√®s 30 secondes</li>
            <li>‚úÖ Ne s'affiche plus apr√®s fermeture (localStorage = "true")</li>
        </ul>
        
        <h3>üîß Console JavaScript</h3>
        <div class="code-block" id="consoleOutput">
            Aucun √©v√©nement...
        </div>
    </div>

    <script>
        const BANNER_KEY = 'whisper_privacy_banner_dismissed';
        const banner = document.getElementById('privacyBanner');
        const closeBtn = document.getElementById('closeBanner');
        const consoleOutput = document.getElementById('consoleOutput');
        let autoHideTimeout = null;
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const newLog = `[${timestamp}] ${message}`;
            console.log(newLog);
            
            const current = consoleOutput.textContent;
            if (current === 'Aucun √©v√©nement...') {
                consoleOutput.textContent = newLog;
            } else {
                consoleOutput.textContent = newLog + '\n' + current.split('\n').slice(0, 9).join('\n');
            }
        }
        
        function shouldShowBanner() {
            const dismissed = localStorage.getItem(BANNER_KEY);
            return dismissed !== 'true';
        }
        
        function showBanner() {
            if (banner) {
                banner.style.display = 'block';
                banner.style.animation = 'slideDown 0.3s ease-out';
                log('‚úÖ Bandeau affich√©');
                
                // Auto-hide apr√®s 30 secondes
                if (autoHideTimeout) clearTimeout(autoHideTimeout);
                autoHideTimeout = setTimeout(() => {
                    log('‚è∞ Auto-fermeture apr√®s 30 secondes');
                    dismissBanner();
                }, 30000);
            }
        }
        
        function dismissBanner() {
            if (banner) {
                banner.style.animation = 'slideUp 0.3s ease-out';
                setTimeout(() => {
                    banner.style.display = 'none';
                    localStorage.setItem(BANNER_KEY, 'true');
                    log('‚ùå Bandeau ferm√© d√©finitivement');
                    checkStatus();
                }, 300);
                
                if (autoHideTimeout) {
                    clearTimeout(autoHideTimeout);
                    autoHideTimeout = null;
                }
            }
        }
        
        function checkStatus() {
            const dismissed = localStorage.getItem(BANNER_KEY);
            const statusDiv = document.getElementById('statusDisplay');
            
            if (dismissed === 'true') {
                statusDiv.innerHTML = `
                    <div class="status-box">
                        <strong>‚úÖ Statut :</strong> Bandeau d√©finitivement ferm√©<br>
                        <strong>üìå localStorage :</strong> <code>whisper_privacy_banner_dismissed = "true"</code>
                    </div>
                `;
                log('‚ÑπÔ∏è Statut : Bandeau ferm√©');
            } else {
                statusDiv.innerHTML = `
                    <div class="status-box error">
                        <strong>‚ö†Ô∏è Statut :</strong> Bandeau non encore ferm√©<br>
                        <strong>üìå localStorage :</strong> <code>whisper_privacy_banner_dismissed = null</code><br>
                        <small>Le bandeau s'affichera √† la prochaine visite</small>
                    </div>
                `;
                log('‚ÑπÔ∏è Statut : Bandeau actif');
            }
        }
        
        function resetBanner() {
            localStorage.removeItem(BANNER_KEY);
            banner.style.display = 'none';
            log('üîÑ localStorage effac√© - bandeau r√©initialis√©');
            checkStatus();
        }
        
        function simulateFirstVisit() {
            resetBanner();
            setTimeout(() => {
                if (shouldShowBanner()) {
                    showBanner();
                    log('‚ú® Simulation : premi√®re visite');
                }
            }, 500);
        }
        
        // Event listeners
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                log('üñ±Ô∏è Clic sur bouton de fermeture');
                dismissBanner();
            });
            
            closeBtn.addEventListener('mouseenter', () => {
                closeBtn.style.opacity = '1';
                closeBtn.style.transform = 'scale(1.2)';
            });
            
            closeBtn.addEventListener('mouseleave', () => {
                closeBtn.style.opacity = '0.7';
                closeBtn.style.transform = 'scale(1)';
            });
        }
        
        // Initialisation
        window.addEventListener('load', () => {
            log('üöÄ Page charg√©e');
            checkStatus();
            
            // Simuler le comportement r√©el : afficher si jamais vu
            if (shouldShowBanner()) {
                setTimeout(showBanner, 1000);
            } else {
                log('‚ÑπÔ∏è Bandeau d√©j√† ferm√©, pas d\'affichage');
            }
        });
    </script>
</body>
</html>
